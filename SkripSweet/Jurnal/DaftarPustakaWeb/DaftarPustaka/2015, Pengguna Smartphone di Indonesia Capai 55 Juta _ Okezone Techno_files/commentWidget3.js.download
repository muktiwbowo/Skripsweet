(function($){$.fn.commentWidget=function(options){var theContainer=null;var settings=$.extend({self:this,okezone_id:String,content:{},from_name:String,source:'desktop',parent_id:null,server_address:"https://comment.okezone.com/",defaultPerPage:10,div_pagination:"#pagination",paginationInfo:"#paginationInfo",div_perPage:"#perPage",tbfplaceHolder:"Bergabung diskusi...",totalComment:null,csrf:null,maxlength:250,content_type:1,thetoken:null,sso_login_link:"https://id.okezone.com",appkey:'allchannelokezonecom',},options);var theVar=$.extend({currentPage:1,totalComment:0,Identified:null,SearchValue:"",perPage:settings.defaultPerPage,direcAction:"index",dropdownFilter:settings.dropdownFilter,selectedSortType:null,selectedSortField:null,daterangeFilter:null,parentId:null,_child:[],});var self=$(this);var _selector=self.selector;bringentrustedandflush()
touching()
readNOtif()
setTimeout(function(){initFirstForm();execute();},1000)
setTimeout(function(){toLastComment()},1300)
function readNOtif(){if($.cookie('IDSTATUS')){$.ajax({dataType:"json",type:"POST",url:settings.server_address+'notification/read',data:{content_id:settings.content.id,IDACCESS:$.cookie('IDACCESS')},success:function(result){},error:function(er_je){console.log(er_je.responseText)},});}}function touching(thetoken){if(!thetoken){$.ajax({dataType:"json",type:"POST",url:settings.server_address+'auth/touch',data:{appkey:settings.appkey},success:function(data){if(data.status==200){settings.thetoken=(data.message.token)}else{console.log(data.status+"\n"+data.message)}},error:function(er_je){console.log(er_je.responseText)},});}}function initFirstForm(){var firstOne='<div id="loadMoreComment"></div></div><ul class="user-comment list-unstyled"></ul><div class="firstAreaComment">';$(_selector).html(firstOne)
$('.firstAreaComment').html(firstAreaComment())
$("#theBossForm").submit(function(e){e.preventDefault();if($(this).find('textarea').val()==''){$(this).find('.alolert').html('<div class = "alert alert-danger alert-dismissable"><button type = "button" class = "close" data-dismiss = "alert" aria-hidden = "true">&times;</button>Komentar tidak boleh kosong</div>')}else{paper_plane($(this),true)
$('#theBossForm textarea').val('');$('#theBossForm textarea').attr('placeholder',settings.tbfplaceHolder);$('#theBossForm').removeClass('open').addClass('default');}})
$.ajax({dataType:"json",type:"POST",data:{signature:JSON.stringify({token:settings.thetoken,appkey:settings.appkey}),},url:settings.server_address+'comment/total/parent/'+settings.content.id,success:function(data){$jSize=theVar.totalComment=data.totalRow;var no_of_paginations=Math.ceil(parseInt($jSize)/parseInt(theVar.perPage));$('.commentWidget-total').html("<b>"+$jSize+"</b> <span>Komentar</span>")
$('.commentWidget-total1').html($jSize+" Komentar")
$('.commentWidget-totalm').html("<span id='hits_comment_top'>"+$jSize+" </span> Komentar")
$('.grouporder').html(setUpOrderby())
var _htmlTombol="<button class='loadvefore' data-current_page='1' data-total_page='"+no_of_paginations+"'>Muat Komentar Sebelumnya</button>";$('#loadMoreComment').html(_htmlTombol);$('#loadMoreComment').find('button').click(function(){theVar.currentPage=parseInt($(this).data('current_page')+1);execute()
$(this).data('current_page',theVar.currentPage)
if(theVar.currentPage==no_of_paginations)$(this).remove()});},error:function(er_je){console.log(er_je.responseText)},});var hash=window.location.hash;if(hash=="#newestComment"){var top=document.getElementById("loadMoreComment").offsetTop;window.scrollTo(0,top);}}function paper_plane(parform,boss=false){if($(_selector).find('.empty').length>0)$(_selector).find('.empty').remove()
if(boss)var eurl=settings.server_address+'comment/insert/parent';else
var eurl=settings.server_address+'comment/insert/child';var pdata={content_id:$(parform).find('input[name="content_id"]').val(),channel_id:$(parform).find('input[name="channel_id"]').val(),title:settings.content.title,content_created:$(parform).find('input[name="content_created"]').val(),url:$(parform).find('input[name="url"]').val(),content_type:settings.content.type,comment:$(parform).find('textarea[name="comment_body"]').val(),parent_id:$(parform).find('input[name="parent_id"]').val(),source:settings.source,IDACCESS:$.cookie('IDACCESS'),signature:JSON.stringify({token:settings.thetoken,appkey:settings.appkey}),};$.ajax({dataType:"json",type:"POST",url:eurl,data:pdata,success:function(result){if(result.statusCode==4001){entrusted(result.data)
window.location=settings.sso_login_link;}var wpdata=result.data;wpdata.waktu=["baru saja","baru saja","baru saja","baru saja"];if(boss)htmlBossPost([wpdata])
else{$.ajax({dataType:"json",type:"POST",data:{signature:JSON.stringify({token:settings.thetoken,appkey:settings.appkey}),},url:settings.server_address+'comment/total/parent/'+pdata.parent_id,success:function(datah){var ntr=(datah.totalRow)
var ppre=$("ul").find("[data-id='"+pdata.parent_id+"']");if(ppre.find('.fa-angle').length>0){ppre.find('.balasan').html(ntr+" Balasan "+"<i class='fa fa-angle-down'></i>")}else{ppre.find('.balasan').addClass('fa-angle').html(ntr+" Balasan "+"<i class='fa fa-angle-down'></i>")}attributeAffairs();htmlChild([wpdata],true)},error:function(er_je){console.log(er_je.responseText)},});}},error:function(er_je){console.log(er_je.responseText)},});}function execute(){var iStart=theVar.currentPage*theVar.perPage;var getCP=theVar.currentPage-1;$.ajax({dataType:"json",type:"POST",data:{signature:JSON.stringify({token:settings.thetoken,appkey:settings.appkey}),},url:settings.server_address+'comment/fetch/'+settings.content.id+'/10/'+getCP,success:function(data){dataAffairs(data)
attributeAffairs();settings.totalComment=data.totalRow;},error:function(er_je){console.log(er_je.responseText)},});}function unbindBefore(){$('.tanggapin').unbind('click')
$('.fa-angle').unbind('click')
$("textarea").unbind('keyup')
$("textarea").unbind('keydown')
$(".theForm").unbind('submit')}function attributeAffairs(){unbindBefore();$('.fa-angle').click(function(){var sioja=$(this).closest('li').find('.theChild')
if(sioja.hasClass('angle-down')){$('.fa-angle').find('i').addClass('fa-angle-up').removeClass('fa-angle-down')
sioja.addClass('angle-up').removeClass('angle-down')}else{$('.fa-angle').find('i').addClass('fa-angle-down').removeClass('fa-angle-up')
sioja.addClass('angle-down').removeClass('angle-up')}})
$("textarea").keyup(function(){var countt=$(this).closest('form').find('.count')
countt.val((settings.maxlength-$(this).val().length));}).keydown(function(){var countt=$(this).closest('form').find('.count')
countt.val((settings.maxlength-$(this).val().length));});$('.tanggapin').click(function(){var buttonIi=$(this);var das=buttonIi.closest($('li'))
var form=das.find('form')
if(buttonIi.html()=='Balas'){buttonIi.html('Tutup')
form.find('textarea').focus()
form.removeClass('default').addClass('open');}else{buttonIi.html('Balas')
form.removeClass('open').addClass('default');}})
$(".theForm").submit(function(e){e.preventDefault();if($(this).find('textarea').val()==''){$(this).find('.alolert').html('<div class = "alert alert-danger alert-dismissable"><button type = "button" class = "close" data-dismiss = "alert" aria-hidden = "true">&times;</button>Komentra tidak boleh kosong</div>')}else{paper_plane($(this))
$('textarea[name="comment_body"]').val('')
$('.tanggapin').removeClass('fly-away')
$(this).closest('li').find('.balas').html('Balas')
$('form').removeClass('open').addClass('default');}})
$('.getChild').click(function(){var parentId=$(this).attr('data-parent_id');var currentPage=parseInt($(this).attr('data-current_page'));var ncupage=currentPage+1;var dtc=$(this).attr('data-total_child');var dcp=$(this).attr('data-current_page');var dcp2=dcp*settings.defaultPerPage;if(dcp2>=dtc)$(this).remove()
theVar._child[parentId]={cPage:currentPage,tPid:parentId,};theVar._child['currentParentId']=parentId;getChild();$(this).attr('data-current_page',ncupage);})}function dataAffairs(jData){var _htmlContainer="";if(jData.totalRow==0){_htmlContainer="<div class='empty'>Jadi yang pertama mengomentari berita ini</div>";$("#loadMoreComment").html('')}else{if(jData.totalRow<=settings.defaultPerPage){$("#loadMoreComment").html('')}for(var u in jData.commentLists){var ccomment=jData.commentLists[u];var singleLi="";var okz_idstring=ccomment.okezone_id;if(okz_idstring.indexOf("OKZ-")==-1)var okz_id="OKZ-"+ccomment.okezone_id
else
var okz_id=ccomment.okezone_id
singleLi+="<div class='img-sso user-thumb'><div class='bgpprofile' style='background:url(https://imgsso.okezone.com/image_profile/"+okz_id+"/"+okz_id+".jpg?w=100); background-size:cover; background-position:center'></div></div>";singleLi+="<div class='comment-content'>";singleLi+="<div class='from-name user-name'><a target='_blank' href='http://id.okezone.com/"+okz_id+"'>"+ccomment.from_name+"</a> - <span title='"+ccomment.waktu[1]+"'>"+ccomment.waktu[3]+"</span></div>";singleLi+="<div class='comment-td user-komentar'>"+ccomment.comment+"</div>";singleLi+="<a class='balas tanggapin'>Balas</a>";if(ccomment.childLists.length>0)var balesanApa="<a class='balasan fa-angle'>"+ccomment.childLists.length+" Balasan  <i class='fa fa-angle-down'></i></a>";else
var balesanApa="<a class='balasan'>Belum ada balasan</a>";singleLi+=balesanApa;var hac0="";if(ccomment.childLists.length>0){var cchild=ccomment.childLists;hac0=htmlChild(cchild);}singleLi+="</div>";singleLi+="<div class='clear'></div><div class='child-box'> <ul class='theChild angle-down'>"+hac0+"</ul></div>";var fformElement="<textarea maxlength='"+settings.maxlength+"' class='comment dialog__content' name='comment_body'></textarea>"
fformElement+="<input type='hidden' name='parent_id' value='"+ccomment.id+"'>";fformElement+="<input type='hidden' name='content_id' value='"+settings.content.id+"'>";fformElement+="<input type='hidden' name='channel_id' value='"+settings.content.channel_id+"'>";fformElement+="<input type='hidden' name='url' value='"+settings.content.url+"'>";fformElement+="<input type='hidden' name='content_created' value='"+settings.content.created+"'>";fformElement+="<input type='text' class='count' title='karakter tersisa' readonly value='250'>";fformElement+="<button class='kirim'> Kirim </button>";var theminiForm="<form  method='post' class='theForm default' ><div class='alolert'></div>"+fformElement+"</form>";var buttone="<div class='div-penanggapan'><button class='tanggapin btn btn-default'   data-parent_id ='"+ccomment.id+"'>Komentari</button></div>";var buttone="<div class='action-below'>"+buttone+"</div>";singleLi+=theminiForm
singleLi="<li data-id='"+ccomment.id+"'>"+singleLi+"</li>";_htmlContainer=singleLi+_htmlContainer;}}$(_selector).find('ul.user-comment').prepend(_htmlContainer);};function htmlBossPost(cData){var id=cData[0].id;var _htmlContainer="";for(var u in cData){var ccomment=cData[u];var singleLi="";var hac0="";var okz_idstring=ccomment.okezone_id;if(okz_idstring.indexOf("OKZ-")==-1)var okz_id="OKZ-"+ccomment.okezone_id
else
var okz_id=ccomment.okezone_id
singleLi+="<div class='img-sso user-thumb'><div class='bgpprofile' style='background:url(https://imgsso.okezone.com/image_profile/"+okz_id+"/"+okz_id+".jpg?w=100); background-size:cover; background-position:center'></div></div>";singleLi+="<div class='comment-content'>";singleLi+="<div class='from-name user-name'><a target='_blank' href='http://id.okezone.com/"+okz_id+"'>"+ccomment.from_name+"</a> - <span title='"+ccomment.waktu[1]+"'>"+ccomment.waktu[3]+"</span></div>";singleLi+="<div class='comment-td user-komentar'>"+ccomment.comment+"</div>";singleLi+="<a class='balas tanggapin'>Balas</a>";var balesanApa="<a class='balasan'>Belum ada balasan</a>";singleLi+=balesanApa;singleLi+="</div>";singleLi+="<div class='clear'></div><div class='child-box'> <ul class='theChild'>"+hac0+"</ul></div>";var fformElement="<textarea maxlength='"+settings.maxlength+"' class='comment dialog__content' name='comment_body'></textarea>"
fformElement+="<input type='hidden' name='parent_id' value='"+ccomment.id+"'>";fformElement+="<input type='hidden' name='content_id' value='"+settings.content.id+"'>";fformElement+="<input type='hidden' name='channel_id' value='"+settings.content.channel_id+"'>";fformElement+="<input type='hidden' name='url' value='"+settings.content.url+"'>";fformElement+="<input type='hidden' name='content_created' value='"+settings.content.created+"'>";fformElement+="<input type='text' class='count' title='karakter tersisa' readonly value='250'>";fformElement+="<button class='kirim'> Kirim </button>";var theminiForm="<form  method='post' class='theForm default' >"+fformElement+"</form>";var buttone="<div class='div-penanggapan'><button class='tanggapin_jn btn btn-default'   data-parent_id ='"+ccomment.id+"'>Komentari</button></div>";var buttone="<div class='action-below'>"+buttone+"</div>";singleLi+=theminiForm
_htmlContainer="<li data-id='"+ccomment.id+"'>"+singleLi+"</li>";}$('ul.user-comment').append(_htmlContainer)
attributeAffairs();}function htmlChild(cData,afterPost=false){var par=cData[0].parent_id;var _htmlContainer="";for(var u in cData){var singleLi="";var ccomment=cData[u];var okz_idstring=ccomment.okezone_id;if(okz_idstring.indexOf("OKZ-")==-1)var okz_id="OKZ-"+ccomment.okezone_id
else
var okz_id=ccomment.okezone_id
singleLi+="<div class='img-sso user-thumb'><div class='bgpprofile' style='background:url(https://imgsso.okezone.com/image_profile/"+okz_id+"/"+okz_id+".jpg?w=100); background-size:cover; background-position:center'></div></div>";singleLi+="<div class='from-name user-name'><a target='_blank' href='http://id.okezone.com/"+okz_id+"'>"+ccomment.from_name+"</a> - <span title='"+ccomment.waktu[1]+"'>"+ccomment.waktu[3]+"</span></div>";singleLi+="<div class='comment-td user-komentar'>"+ccomment.comment+"</div>";if(afterPost)var jcclas='justComment';else
var jcclas='';_htmlContainer+="<li class='"+jcclas+"'>"+singleLi+"</li>";}if(afterPost){var celector=$('ul.user-comment').find('li[data-id="'+par+'"]').find('.child-box')
$(celector.find('.theChild')).append(_htmlContainer);setTimeout(function(){$('.justComment').removeClass('justComment')},90)}else{return _htmlContainer;}}function entrusted(jjson){localStorage.setItem('okz.sso.comment',JSON.stringify(jjson));}function bringentrustedandflush(){if(localStorage.getItem('okz.sso.comment')&&($.cookie('IDSTATUS'))){var loge=JSON.parse(localStorage.getItem('okz.sso.comment'));var ccontent=settings.content;if((loge.content.id==ccontent.id)&&(loge.content.url==ccontent.url)){var fjdata={_id:loge._id,content_id:loge.content.id,IDACCESS:$.cookie('IDACCESS'),signature:JSON.stringify({token:settings.thetoken,appkey:settings.appkey}),}
$.ajax({dataType:"json",type:"POST",url:settings.server_address+'comment/update_from_login',data:fjdata,success:function(result){console.log(result)},error:function(er_je){console.log(er_je.responseText)},});}}localStorage.removeItem('okz.sso.comment');}function setUpOrderby(){return'<div class="orderBy"><b>Urutkan</b><div class="btn-group" role="group" aria-label="..."><button type="button" class="btn btn-default">Terbaru</button><button type="button" class="btn btn-default">Terlama</button><button type="button" class="btn btn-default">Terpopuler</button></div></div>';}function firstAreaComment(){var fformElement="<textarea maxlength='"+settings.maxlength+"' placeholder='"+settings.tbfplaceHolder+"' class='comment dialog__content' name='comment_body'></textarea>"
fformElement+="<input type='hidden' name='content_id' value='"+settings.content.id+"'>";fformElement+="<input type='hidden' name='channel_id' value='"+settings.content.channel_id+"'>";fformElement+="<input type='hidden' name='url' value='"+settings.content.url+"'>";fformElement+="<input type='hidden' name='content_created' value='"+settings.content.created+"'>";var dbttn='<div class="ffoot"><input type="text" class="count" title="karakter tersisa" readonly value="250"><button type="submit">Kirim</button><button type="reset">Batal</button></div>';return'<div class="firstAreaComment"><form class="default" id="theBossForm">  '+fformElement+dbttn+'<div class="alolert"></div> </form></div><div id="lastComment" name="lastComment"></div>';}function toLastComment(){var caop39=window.location.hash;if(caop39=="#lastComment"){var jxp9re=$('.commentWidget-total');var totmen=parseInt(jxp9re.find('b').html());var f9j=(totmen*.5)*10;if(totmen<5)f9j=0;var clj9zd=$(caop39).offset().top-680;$('html, body').animate({scrollTop:clj9zd},150);}}};}(jQuery));